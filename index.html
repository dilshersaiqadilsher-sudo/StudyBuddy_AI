<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Smart AI Friend â€” Ultimate</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<style>
:root{
  --bg:#050b1a;--card:#0b1225;--user:#2f6bff;--bot:#111827;--text:#fff;
}
body.light{
  --bg:#f3f4f6;--card:#fff;--user:#2563eb;--bot:#e5e7eb;--text:#111827;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;min-height:100vh;
  background:radial-gradient(circle at top,var(--bg),#000);
  display:flex;align-items:center;justify-content:center;
  color:var(--text);
}
.app{
  width:380px;height:650px;background:var(--card);
  border-radius:18px;display:flex;flex-direction:column;overflow:hidden;
}
.header{padding:14px;background:linear-gradient(135deg,#2563eb,#38bdf8);color:#fff;text-align:center}
.toolbar{display:flex;gap:6px;padding:8px}
.toolbar button{flex:1;border:none;border-radius:10px;padding:8px;cursor:pointer}
.chat{flex:1;overflow-y:auto;padding:12px}
.msg{max-width:80%;padding:10px 12px;border-radius:14px;margin-bottom:10px;font-size:14px}
.user{background:var(--user);color:#fff;margin-left:auto}
.bot{background:var(--bot)}
.inputbar{display:flex;gap:6px;padding:10px}
.inputbar input{flex:1;padding:10px;border-radius:12px;border:none}
.send,.mic{width:42px;border:none;border-radius:12px;color:#fff;font-size:18px;cursor:pointer}
.send{background:#22c55e}
.mic{background:#ef4444}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h3>Ultra Smart AI Friend âš¡ Ultimate</h3>
    <small id="date"></small>
  </div>

  <div class="toolbar">
    <button id="modeBtn">ðŸŒ™ Mode</button>
    <button id="clearBtn">ðŸ§¹ Clear</button>
    <button id="aiBtn">ðŸ¤– AI: ON</button>
  </div>

  <div class="chat" id="chat"></div>

  <div class="inputbar">
    <button class="mic" id="mic">ðŸŽ¤</button>
    <input id="input" placeholder="Ask anything or speakâ€¦" />
    <button class="send" id="send">â–¶</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const AI_PROVIDER = "openai"; // "openai" or "gemini"

/* âš ï¸ ADD YOUR KEY HERE */
const OPENAI_KEY = "PASTE_OPENAI_KEY";
const GEMINI_KEY = "PASTE_GEMINI_KEY";
/* ========================================= */

console.log("Ultra Smart AI v4 loaded");

const chat=document.getElementById("chat");
const input=document.getElementById("input");
const sendBtn=document.getElementById("send");
const clearBtn=document.getElementById("clearBtn");
const modeBtn=document.getElementById("modeBtn");
const micBtn=document.getElementById("mic");
const aiBtn=document.getElementById("aiBtn");

document.getElementById("date").textContent=new Date().toDateString();

/* ---------- STORAGE ---------- */
function saveChat(){localStorage.setItem("chat",chat.innerHTML)}
function loadChat(){
  const c=localStorage.getItem("chat");
  if(c) chat.innerHTML=c;
  else addMsg("Hello ðŸ‘‹ I'm Ultra Smart AI Friend.","bot");
}

/* ---------- UI ---------- */
function addMsg(text,cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  saveChat();
}
function clearChat(){
  if(!confirm("Clear chat?")) return;
  chat.innerHTML="";
  localStorage.removeItem("chat");
  addMsg("Hello ðŸ‘‹ I'm Ultra Smart AI Friend.","bot");
}

/* ---------- AI ---------- */
async function askAI(prompt){
  addMsg("Thinkingâ€¦","bot");

  if(AI_PROVIDER==="openai"){
    const res=await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer "+OPENAI_KEY
      },
      body:JSON.stringify({
        model:"gpt-4o-mini",
        messages:[{role:"user",content:prompt}]
      })
    });
    const data=await res.json();
    return data.choices[0].message.content;
  }

  if(AI_PROVIDER==="gemini"){
    const res=await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_KEY}`,
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          contents:[{parts:[{text:prompt}]}]
        })
      }
    );
    const data=await res.json();
    return data.candidates[0].content.parts[0].text;
  }
}

/* ---------- LOGIC ---------- */
function isMath(t){return /^[0-9+\-*/().%\s]+$/.test(t)}

async function respond(text){
  const t=text.toLowerCase().trim();

  if(["clear","clear chat","delete","delete chat","/clear"].includes(t)){
    clearChat(); return;
  }

  if(isMath(t)){
    try{addMsg("ðŸ§® "+eval(t),"bot");return}catch{}
  }

  const reply=await askAI(text);
  chat.lastChild.remove();
  addMsg(reply,"bot");
}

function send(){
  const t=input.value.trim();
  if(!t) return;
  addMsg(t,"user");
  input.value="";
  respond(t);
}

/* ---------- EVENTS ---------- */
sendBtn.onclick=send;
input.addEventListener("keydown",e=>e.key==="Enter"&&send());
clearBtn.onclick=clearChat;

modeBtn.onclick=()=>{
  document.body.classList.toggle("light");
  localStorage.setItem("mode",document.body.classList.contains("light"));
};

if(localStorage.getItem("mode")==="true")
  document.body.classList.add("light");

/* ---------- VOICE ---------- */
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SpeechRecognition){
  const rec=new SpeechRecognition();
  rec.lang="en-US";
  micBtn.onclick=()=>{
    rec.start();
    micBtn.textContent="ðŸŽ™ï¸";
  };
  rec.onresult=e=>{
    input.value=e.results[0][0].transcript;
    micBtn.textContent="ðŸŽ¤";
    send();
  };
}

/* ---------- START ---------- */
loadChat();

/* ---------- SERVICE WORKER ---------- */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
